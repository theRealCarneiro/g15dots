#!/bin/sh

card=$(readlink /dev/dri/nvidia-dgpu)

state=$(cat /sys/class/drm/${card}/device/power_state)

class="$state"

[ -f "/tmp/nvidia-smi" ] && tooltip=$(cat /tmp/nvidia-smi | sed ':a;N;$!ba;s/\n/\\n/g')
[ -z "$tooltip" ] && tooltip=$state

printf '{"text": "", "tooltip": "%s", "alt": "%s", "class": "%s"}\n' "$tooltip" "$state" "$class"
