#!/usr/bin/env python3

import time
import math
import json
import psutil


def column(list1, list2):
    # col =
    for a, b in zip(list1, list2):
        print(a, r'\d', b)


# dummy output so script does delay startup
output = {'text': "1", 'tooltip': '', 'class': 'default'}
print(json.dumps(output), flush=True)

psutil.cpu_percent(interval=1, percpu=False)

while True:
    usage = psutil.cpu_percent(interval=None)
    usage_per_cpu = psutil.cpu_percent(interval=None, percpu=True)

    cpu_usage_str = '\n'.join(f'CPU{index}:\t{core_usage}%' for index, core_usage in enumerate(usage_per_cpu))
    tooltip = cpu_usage_str
    output = {
        'text': str(math.ceil(usage)),
        'tooltip': tooltip,
        'class': 'default'
    }
    print(json.dumps(output), flush=True)

    time.sleep(2)
